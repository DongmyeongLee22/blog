(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{479:function(e,t,a){e.exports=a.p+"assets/img/single_dc_cluster.99b4fbf9.png"},480:function(e,t,a){e.exports=a.p+"assets/img/write_with_quorum.c1d2280c.png"},481:function(e,t,a){e.exports=a.p+"assets/img/read_with_quorum.c2f1f0a7.png"},517:function(e,t,a){"use strict";a.r(t);var s=a(56),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("카산드라는 기본적으로 "),s("code",[e._v("Eventual consistency")]),e._v("를 보장하는 Storage system이지만 Consistency Level 설정에 따라 "),s("code",[e._v("Strong Consistency")]),e._v("를 보장받을 수 있다.")]),e._v(" "),s("h2",{attrs:{id:"eventual-consistency-vs-strong-consistency"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventual-consistency-vs-strong-consistency"}},[e._v("#")]),e._v(" Eventual Consistency vs Strong Consistency")]),e._v(" "),s("h3",{attrs:{id:"eventual-consistency"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventual-consistency"}},[e._v("#")]),e._v(" Eventual Consistency")]),e._v(" "),s("ul",[s("li",[e._v("최종적으로는 데이터의 Consistency를 보장하지만 현재 시점에는 데이터의 Consistency를 보장할 수 없다.")]),e._v(" "),s("li",[e._v("즉 "),s("code",[e._v("클라이언트에게 반환하는 데이터가 최신 상태의 데이터가 아닐 가능성이 존재하는 것이다.")])]),e._v(" "),s("li",[e._v("항상 최신 상태의 데이터 반환을 보장하지 않으므로 적은 수에 node에게 의존한다. 그러므로 Strong Consistency를 보장하는 시스템에 비해 "),s("code",[e._v("Availability은 높고 Latency는 낮다")])])]),e._v(" "),s("h3",{attrs:{id:"strong-consistency"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strong-consistency"}},[e._v("#")]),e._v(" Strong Consistency")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("클라이언트에게 반환하는 데이터가 항상 최신 상태의 데이터임을 보장한다.")])]),e._v(" "),s("li",[e._v("항상 최신 상태의 데이터를 반환해야 하므로 많은 수의 node에게 의존한다. 그러므로 Eventual Consistency를 보장하는 시스템에 비해 "),s("code",[e._v("Availability은 낮고 Latency는 높다")])])]),e._v(" "),s("h3",{attrs:{id:"요약"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#요약"}},[e._v("#")]),e._v(" 요약")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th"),e._v(" "),s("th",{staticStyle:{"text-align":"center"}},[e._v("Availability")]),e._v(" "),s("th",{staticStyle:{"text-align":"right"}},[e._v("Latency")]),e._v(" "),s("th",{staticStyle:{"text-align":"right"}},[e._v("return latest data")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("Eventual Consistency")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("높음")]),e._v(" "),s("td",{staticStyle:{"text-align":"right"}},[e._v("낮음")]),e._v(" "),s("td",{staticStyle:{"text-align":"right"}},[e._v("보장 X")])]),e._v(" "),s("tr",[s("td",[e._v("Strong Consistency")]),e._v(" "),s("td",{staticStyle:{"text-align":"center"}},[e._v("낮음")]),e._v(" "),s("td",{staticStyle:{"text-align":"right"}},[e._v("높음")]),e._v(" "),s("td",{staticStyle:{"text-align":"right"}},[e._v("보장 O")])])])]),e._v(" "),s("h2",{attrs:{id:"strong-consistency를-보장할-수-있는-consistency-level"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strong-consistency를-보장할-수-있는-consistency-level"}},[e._v("#")]),e._v(" Strong Consistency를 보장할 수 있는 Consistency Level")]),e._v(" "),s("blockquote",[s("p",[e._v("Consistency Level에 대해 궁금하시면 "),s("a",{attrs:{href:"http://localhost:8081/blog/Cassandra/Cassandra_Consistency_Level.html#write-consistency-levels",target:"_blank",rel:"noopener noreferrer"}},[e._v("카산드라 Consistency Level"),s("OutboundLink")],1),e._v(" 게시글을 참고하세요.")])]),e._v(" "),s("p",[s("strong",[e._v("카산드라 Ring Cluster 구성은 아래와 같다고 가정한다.")]),e._v(" "),s("img",{attrs:{src:a(479),alt:"single_dc_cluster"}})]),e._v(" "),s("ul",[s("li",[e._v("Single datacenter")]),e._v(" "),s("li",[e._v("Replication factor: 3")])]),e._v(" "),s("h3",{attrs:{id:"_1-write-all-read-one"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-write-all-read-one"}},[e._v("#")]),e._v(" 1. Write: ALL, Read: ONE")]),e._v(" "),s("ul",[s("li",[e._v("Write consistency level이 ALL이므로 "),s("code",[e._v("모든 replica node에 write request가 처리되어야 한다.")])]),e._v(" "),s("li",[e._v("Write ALL로 인해 모든 replica node가 최신 데이터를 가지므로 특정 "),s("code",[e._v("하나의 node에게만 Read 요청을 보내도 최신 상태 데이터를 반환 받을 수 있다.")])])]),e._v(" "),s("p",[s("strong",[e._v("특징")])]),e._v(" "),s("ul",[s("li",[e._v("하나의 node만 다운되어도 Write가 실패하므로 "),s("code",[e._v("Availability가 낮다.")])]),e._v(" "),s("li",[e._v("하지만 Read를 ONE으로 할 수 있기 때문에 "),s("code",[e._v("Read Reuqest의 latency를 최대한 적게하면서 Strong Consistency를 보장할 수 있다.")])]),e._v(" "),s("li",[e._v("Strong consistency가 필요하고 write에 비해 read request가 매우 많다면 고려해볼만 하다.")])]),e._v(" "),s("h3",{attrs:{id:"_2-write-quorum-read-quorum"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-write-quorum-read-quorum"}},[e._v("#")]),e._v(" 2. Write: QUORUM, Read: QUORUM")]),e._v(" "),s("ul",[s("li",[e._v("replication factor가 3이므로 QUORUM=2이다."),s("a",{attrs:{href:"http://localhost:8081/blog/Cassandra/Cassandra_Consistency_Level.html#_2-each-quorum",target:"_blank",rel:"noopener noreferrer"}},[e._v("(QUORUM 구하는 법)"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("즉 2개의 replica node에 write request가 처리되면 Write 동작은 성공한다.")]),e._v(" "),s("li",[e._v("그리고 read request 또한 2개의 replica node에게 전달되므로 전달 받은 "),s("code",[e._v("두개의 node중 하나의 node는 반드시 최신 상태의 데이터를 가지고 있으므로 Strong Consistency가 보장된다.")])])]),e._v(" "),s("p",[s("strong",[e._v("특징")])]),e._v(" "),s("ul",[s("li",[e._v("Read와 Write가 두 개의 node에게 의존하므로 "),s("code",[e._v("하나의 node가 down되어도 정상 동작")])]),e._v(" "),s("li",[e._v("Strong consistency가 필요한 경우 가장 무난하게 적용할 수 있는 Level")])]),e._v(" "),s("h3",{attrs:{id:"_3-write-one-read-all"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-write-one-read-all"}},[e._v("#")]),e._v(" 3. Write: ONE, Read: ALL")]),e._v(" "),s("ul",[s("li",[e._v("Write consistency level이 ONE이므로 하나의 replica node에 write request가 처리되면 Write 동작은 성공한다.")]),e._v(" "),s("li",[e._v("Read consistency level이 ALL이므로 "),s("code",[e._v("모든 replica node에게 read request가 전달되므로 Strong Consistency가 보장된다.")])])]),e._v(" "),s("p",[s("strong",[e._v("특징")])]),e._v(" "),s("ul",[s("li",[e._v("하나의 node만 다운되어도 Read가 실패하므로 "),s("code",[e._v("Availability가 낮다.")])]),e._v(" "),s("li",[e._v("하지만 Write를 ONE으로 할 수 있기 때문에 "),s("code",[e._v("Write Reuqest의 latency를 최대한 적게하면서 Strong Consistency를 보장할 수 있다.")])]),e._v(" "),s("li",[e._v("Strong consistency가 필요하고 트래픽이 write request의 트래픽이 크다면 고려해볼만 하다.")])]),e._v(" "),s("blockquote",[s("p",[e._v("multiple datacenter로 카산드라 클러스터를 구성했을 경우 datacenter 사용 방식에 따라 LOCAL_QUORUM을 활용할 수도 있습니다.")])]),e._v(" "),s("hr"),e._v(" "),s("h3",{attrs:{id:"어떻게-strong-consistency가-보장-될까"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#어떻게-strong-consistency가-보장-될까"}},[e._v("#")]),e._v(" 어떻게 Strong Consistency가 보장 될까?")]),e._v(" "),s("p",[s("code",[e._v("Write: QUORUM, Read: QUORUM")]),e._v(" 케이스에 대한 예시")]),e._v(" "),s("p",[s("img",{attrs:{src:a(480),alt:"write_with_quorum"}})]),e._v(" "),s("ol",[s("li",[e._v("client가 QUORUM consistency level로 write request 전송")]),e._v(" "),s("li",[e._v("coordinator node는 "),s("code",[e._v("모든 replica node에게 write request를 전달")])]),e._v(" "),s("li",[e._v("1번 노드에서 write가 완료되어 ACK 응답")]),e._v(" "),s("li",[e._v("3번 노드에서 write가 완료되어 ACK 응답")]),e._v(" "),s("li",[e._v("QUORUM(2)수 만큼의 replica node에서 write request가 성공했으므로 client에게 응답")])]),e._v(" "),s("blockquote",[s("p",[s("strong",[e._v("5번 노드는 이슈로 인해 write request 실패")])])]),e._v(" "),s("hr"),e._v(" "),s("p",[s("img",{attrs:{src:a(481),alt:"read_with_quorum"}})]),e._v(" "),s("ol",[s("li",[e._v("client가 QUORUM consistency level로 read request 전송")]),e._v(" "),s("li",[e._v("coordinator node는 "),s("code",[e._v("QUORUM 수 만큼의 replica node에게 read request를 전달")])]),e._v(" "),s("li",[e._v("1번 노드는 latest data를 반환")]),e._v(" "),s("li",[s("code",[e._v("5번 노드는 이전의 write request가 실패했으므로 stale data를 반환")])]),e._v(" "),s("li",[e._v("coordinator node는 응답받은 두 개의 데이터의 timestamp를 비교하여 stale data를 가진 5번 node가 latest data를 가질 수 있도록 read repair 수행 ("),s("a",{attrs:{href:"https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/operations/opsRepairNodesReadRepair.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Detail Docs"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[e._v("client에게 latest data를 반환")])]),e._v(" "),s("blockquote",[s("p",[e._v("실제로는 하나의 node에게 direct read request를 보내고 나머지 node에겐 digest request를 보냅니다. 자세한 내용이 궁금하시면 공식 문서("),s("a",{attrs:{href:"https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlClientRequestsRead.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("How are read requests accomplished?\n"),s("OutboundLink")],1),e._v(")를 참고하세요.")])]),e._v(" "),s("h2",{attrs:{id:"참고-자료"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#참고-자료"}},[e._v("#")]),e._v(" 참고 자료")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlAboutDataConsistency.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("How are consistent read and write operations handled?(Datastax)"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlClientRequestsRead.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("How are read requests accomplished?(Datastax)"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.datastax.com/en/cassandra-oss/3.0/cassandra/dml/dmlClientRequestsWrite.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("How are write requests accomplished?(Datastax)"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);