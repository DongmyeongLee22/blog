(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{518:function(s,a,t){s.exports=t.p+"assets/img/forSum_flamegraph.fb90bb93.png"},519:function(s,a,t){s.exports=t.p+"assets/img/streamSum_flamegraph.d1521775.png"},573:function(s,a,t){"use strict";t.r(a);var n=t(31),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"jmh-사용"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jmh-사용"}},[s._v("#")]),s._v(" JMH 사용")]),s._v(" "),n("h3",{attrs:{id:"gradle-플러그인-추가"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gradle-플러그인-추가"}},[s._v("#")]),s._v(" gradle 플러그인 추가")]),s._v(" "),n("div",{staticClass:"language-groovy line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[s._v("plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  id "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"me.champeau.jmh"')]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"0.7.1"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("별다른 의존성 추가없이 "),n("code",[s._v("build.gradle")]),s._v("에 JMH 플러그인("),n("a",{attrs:{href:"https://github.com/melix/jmh-gradle-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("github"),n("OutboundLink")],1),s._v(")만 추가하면 된다.")])]),s._v(" "),n("h3",{attrs:{id:"벤치마크-클래스-위치"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#벤치마크-클래스-위치"}},[s._v("#")]),s._v(" 벤치마크 클래스 위치")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("src/jmh\n     |- java       : java sources for benchmarks\n     |- resources  : resources for benchmarks\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("벤치마크 클래스는 "),n("code",[s._v("src/main/java")]),s._v("가 아닌 "),n("code",[s._v("src/jmh/java")]),s._v("에 작성해야 한다.")]),s._v(" "),n("li",[s._v("플러그인이 "),n("code",[s._v("src/jmh/java")]),s._v(" 내부의 클래스들이 "),n("code",[s._v("src/main/java")]),s._v("에 정의된 클래스를 의존할 수 있게 자동으로 구성해준다.")]),s._v(" "),n("li",[s._v("JMH 옵션에서 "),n("code",[s._v("includeTests=true")]),s._v("로 설정하면 테스트코드도 의존할 수 있게 설정가능하다.")])]),s._v(" "),n("h3",{attrs:{id:"jmh-옵션-설정하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jmh-옵션-설정하기"}},[s._v("#")]),s._v(" JMH 옵션 설정하기")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("jmh {\n    iterations = 3\n    warmupIterations = 3\n    fork = 1\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("build.gradle")]),s._v("에서 jmh 블럭에서 설정할 수 있다.")]),s._v(" "),n("li",[s._v("모든 옵션은 "),n("a",{attrs:{href:"https://github.com/melix/jmh-gradle-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH 플러그인 github"),n("OutboundLink")],1),s._v("에 자세히 나와있다.")])]),s._v(" "),n("h3",{attrs:{id:"벤치마크할-함수-작성"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#벤치마크할-함수-작성"}},[s._v("#")]),s._v(" 벤치마크할 함수 작성")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// src/main/java")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IntStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sum")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("forSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxNum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sum "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" maxNum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            sum "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("streamSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxNum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IntStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rangeClosed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" maxNum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("ul",[n("li",[s._v("1부터 "),n("code",[s._v("maxNum")]),s._v("까지의 숫자를 모두 더하는 함수를 for문과 stream을 이용해서 작성해보고 이 둘의 성능을 비교해보자.")])]),s._v(" "),n("h3",{attrs:{id:"벤치마크-클래스-작성"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#벤치마크-클래스-작성"}},[s._v("#")]),s._v(" 벤치마크 클래스 작성")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// src/jmh/java")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Scope")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("State")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("infra")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blackhole")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@State")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Scope")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SumBenchmark")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("forSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blackhole")]),s._v(" bh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        bh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("consume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("forSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("streamSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blackhole")]),s._v(" bh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        bh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("consume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("streamSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("ul",[n("li",[s._v("기본적인 사용법은 클래스에 "),n("code",[s._v("@State")]),s._v("로 scope를 지정하고 벤치마크할 메서드에 "),n("code",[s._v("@Benchmark")]),s._v("를 붙이면 된다.")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/openjdk/jmh/tree/master/jmh-samples/src/main/java/org/openjdk/jmh/samples",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH Sample"),n("OutboundLink")],1),s._v(" 에서 다양한 JMH Annotation들의 사용법을 살펴볼 수 있다.")]),s._v(" "),n("li",[n("code",[s._v("bh.consume")]),s._v("에 함수의 결과를 넘기는 이유는 JVM이 의도치않게 최적화 하는것을 방지하기 위함이다.")])]),s._v(" "),n("h3",{attrs:{id:"실행"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#실행"}},[s._v("#")]),s._v(" 실행")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./gradlew jmh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("jmh")]),s._v(" gradle 태스크를 실행하면 "),n("code",[s._v("/src/jmh/java")]),s._v("내의 벤치마크 클래스들의 벤치마크가 수행된다.")]),s._v(" "),n("li",[s._v("JMH Options에서 "),n("code",[s._v("includes")]),s._v("를 사용하면 원하는 벤치마크 클래스를 설정할 수 있다.")])]),s._v(" "),n("h3",{attrs:{id:"결과"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#결과"}},[s._v("#")]),s._v(" 결과")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Benchmark                Mode  Cnt        Score        Error  Units\nSumBenchmark.forSum     thrpt    3  4114130.377 ± 111486.127  ops/s\nSumBenchmark.streamSum  thrpt    3  3348063.640 ± 236175.095  ops/s\n\nBenchmark result is saved to /Users/dongmyeonglee/Projects/temp/jmh_blog/build/results/jmh/results.txt\n\nBUILD SUCCESSFUL in 2m 2s\n6 actionable tasks: 6 executed\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("결과를 보면 "),n("code",[s._v("forSum")]),s._v("함수의 스코어가 더 높은 것을 확인할 수 있다.")]),s._v(" "),n("li",[s._v("단위가 "),n("code",[s._v("ops/s")]),s._v("이므로 초당 연산 수가 "),n("code",[s._v("forSum")]),s._v("이 더 높은 것이다. 즉 "),n("code",[s._v("forSum")]),s._v("의 성능이 더 뛰어나다.")])]),s._v(" "),n("h2",{attrs:{id:"async-profiler로-flame-graph-출력하기"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#async-profiler로-flame-graph-출력하기"}},[s._v("#")]),s._v(" async profiler로 flame graph 출력하기")]),s._v(" "),n("p",[s._v("해당 벤치마크할 함수들을 flame graph로 출력하면 호출 스택과 각 호출에 소요된 시간을 한눈에 파악할 수 있다. 왜 "),n("code",[s._v("forStream")]),s._v("이 더 느린지 flame graph로 파악해보자.")]),s._v(" "),n("h3",{attrs:{id:"라이브러리-다운"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#라이브러리-다운"}},[s._v("#")]),s._v(" 라이브러리 다운")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/async-profiler/async-profiler",target:"_blank",rel:"noopener noreferrer"}},[s._v("async-profiler git"),n("OutboundLink")],1),s._v("에서 자신의 OS에 맞는 async-profiler를 다운로드하고 압축을 해제한다.")])]),s._v(" "),n("h3",{attrs:{id:"jmh-옵션-설정하기-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jmh-옵션-설정하기-2"}},[s._v("#")]),s._v(" JMH 옵션 설정하기")]),s._v(" "),n("div",{staticClass:"language-groovy line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[s._v("jmh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    iterations "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    warmupIterations "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    fork "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    profilers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'async:libPath=/Users/Utils/async-profiler-2.9-macos/build/libasyncProfiler.so;output=flamegraph;dir=async-profiler-results'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("profilers")]),s._v(" 옵션에서 사용하고자 하는 프로파일러를 지정할 수 있다.")]),s._v(" "),n("li",[s._v("async-profiler를 사용하므로 "),n("code",[s._v("async:")]),s._v("를 시작으로 필요한 async-profiler 옵션을 붙이면된다.")]),s._v(" "),n("li",[n("code",[s._v("libPath")]),s._v("에 다운로드한 async-profiler의 파일 위치를 입력하면 된다. MacOS기준으로 "),n("code",[s._v("build/libasyncProfiler.so")]),s._v("를 사용하면된다.")]),s._v(" "),n("li",[n("code",[s._v("flamegraph")]),s._v("로 출력하기 위해 output 옵션을 붙이고 "),n("code",[s._v("async-profiler-results")]),s._v(" 폴더에 결과를 저장하도록 설정했다.")]),s._v(" "),n("li",[s._v("JMH에서 async-profiler에 설정할 수 있는 옵션목록을 보는게 까다로워서 따로 첨부한다.\n"),n("ul",[n("li",[s._v("코드레벨에서 확인도 가능하다: "),n("a",{attrs:{href:"https://github.com/openjdk/jmh/blob/master/jmh-core/src/main/java/org/openjdk/jmh/profile/AsyncProfiler.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("AsyncProfiler.java"),n("OutboundLink")],1)])])])]),s._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("async-profiler options(클릭)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Usage: -prof <profiler-name>:opt1=value1,value2;opt2=value3\n\nOptions accepted by async:\n\noutput=<format+>                 Output format(s). Supported: [text, collapsed,\nflamegraph, tree, jfr]. (default: [text])\n\ndirection=<direction>            Direction(s) of flame graph. Supported: [forward,\nreverse, both]. (default: [both])\n\nlibPath=<path>                   Location of asyncProfiler library. If not specified,\nSystem.loadLibrary will be used and the library\nmust be made available to the forked JVM in an entry\nof -Djava.library.path, LD_LIBRARY_PATH (Linux),\nor DYLD_LIBRARY_PATH (Mac OS).\n\nevent=<event>                    Event to sample: cpu, alloc, lock, wall, itimer;\ncom.foo.Bar.methodName; any event from `perf list`\ne.g. cache-misses (default: [cpu])\n\nalloc=[sample bytes]             Enable allocation profiling. Optional argument\n(e.g. =512k) reduces sampling from the default of\none-sample-per-TLAB. May be captured as a secondary\nevent under output=jfr.\n\nlock=[duration]                  Enable lock profiling. Optional argument (e.g.\n=1ms) limits capture based on lock duration. May\nbe captured as a secondary event under output=jfr.\n\ndir=<dir>                        Output directory.\n\ninterval=<ns>                    Profiling interval.\n\njstackdepth=<frames>             Maximum Java stack depth.\n\nframebuf=<bytes>                 Size of profiler framebuffer.\n\nfilter=<boolean>                 Enable thread filtering during collection. Useful\nfor wall clock profiling, but only if the workload\nregisters the relevant threads programatically\nvia `AsyncProfiler.JavaApi.getInstance().filterThread(thread,\nenabled)`. (default: [false])\n\nthreads=<bool>                   Profile threads separately.\n\nsimple=<bool>                    Simple class names instead of FQN.\n\nsig=<bool>                       Print method signatures.\n\nann=<bool>                       Annotate Java method names.\n\ninclude=<regexp+>                Output only stack traces containing the specified\npattern.\n\nexclude=<regexp+>                Exclude stack traces with the specified pattern.\n\nrawCommand=<command>             Command to pass directly to async-profiler. Use\nto access new features of JMH profiler that are not\nyet supported in this option parser.\n\ntitle=<string>                   SVG title.\n\nwidth=<pixels>                   SVG width.\n\nminwidth=<pixels>                Skip frames smaller than px\n\nallkernel=<bool>                 Only include kernel-mode events.\n\nalluser=<bool>                   Only include user-mode events.\n\ncstack=<mode>                    How to traverse C stack: Supported: [fp, lbr, no].\n\nverbose=<bool>                   Output the sequence of commands. (default: [false])\n\ntraces=<int>                     Number of top traces to include in the default output.\n(default: [200])\n\nflat=<int>                       Number of top flat profiles to include in the default\noutput. (default: [200])\n\nhelp                             Display help.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br")])])]),s._v(" "),n("h3",{attrs:{id:"실행-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#실행-2"}},[s._v("#")]),s._v(" 실행")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./gradlew jmh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("실행 방법은 jmh 벤치마크를 돌리면 된다.")])]),s._v(" "),n("h3",{attrs:{id:"결과-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#결과-2"}},[s._v("#")]),s._v(" 결과")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Benchmark                       Mode  Cnt        Score        Error  Units\nSumBenchmark.forSum            thrpt    3  4101825.711 ± 194568.428  ops/s\nSumBenchmark.forSum:·async     thrpt               NaN                 ---\nSumBenchmark.streamSum         thrpt    3  3326454.191 ± 271385.971  ops/s\nSumBenchmark.streamSum:·async  thrpt               NaN                 ---\n\nBenchmark result is saved to /Users/dongmyeonglee/Projects/temp/jmh_blog/build/results/jmh/results.txt\n\nBUILD SUCCESSFUL in 2m 3s\n7 actionable tasks: 7 executed\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("ul",[n("li",[s._v("이전과 다르게 "),n("code",[s._v("SumBenchmark.forSum:·async")]),s._v(", "),n("code",[s._v("SumBenchmark.streamSum:·async")]),s._v("가 추가된 것을 확인할 수 있다.")]),s._v(" "),n("li",[n("code",[s._v("async-profiler-results")]),s._v("폴더를 확인해보면 각 벤치마크별 flame graph html 파일이 존재하고 해당 html 파일을 열면 flame graph를 볼 수 있다.")])]),s._v(" "),n("p",[n("strong",[s._v("forSum_flamegraph")]),s._v(":")]),s._v(" "),n("img",{staticStyle:{"max-width":"800px"},attrs:{src:t(518)}}),s._v(" "),n("p",[n("strong",[s._v("streamSum_flamegraph")]),s._v(":")]),s._v(" "),n("img",{staticStyle:{"max-width":"800px"},attrs:{src:t(519)}}),s._v(" "),n("ul",[n("li",[s._v("flame graph를 보면 "),n("code",[s._v("forSum")]),s._v("보다 "),n("code",[s._v("streamSum")]),s._v("에서 추가적인 함수 호출이 존재하는 것을 확인할 수 있다.")]),s._v(" "),n("li",[n("code",[s._v("streamSum")]),s._v("의 추가적인 함수 호출로 인해 스코어가 더 낮은 것이라고 예측이 가능하다.")]),s._v(" "),n("li",[s._v("조금 더 복잡한 로직을 벤치마크 돌릴 떄 flame graph를 활용하면 병목 지점을 찾는데 유용하게 사용할 수 있을 것이다.")])]),s._v(" "),n("h2",{attrs:{id:"참고자료"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#참고자료"}},[s._v("#")]),s._v(" 참고자료")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.youtube.com/watch?v=5UltOhDOjr0&t=3662s",target:"_blank",rel:"noopener noreferrer"}},[s._v("켠 김에 PR까지 18: JMH 와 async-profiler 로 병목 지점을 찾아 보자!"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);